<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Yükseliş</title>
    <style>
        /* Apple ve Tesla estetiğine uygun Minimalist & Dark Mode Tasarım */
        body {
            margin: 0;
            padding: 0;
            background-color: #050505; /* Derin Siyah */
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: white;
            touch-action: none; /* Safari'de kaydırmayı engelle */
            user-select: none;
            -webkit-user-select: none;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Arayüz Katmanı */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Dokunmatik kontrollerin canvas'a geçmesine izin ver */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Üst Bilgi Paneli */
        .hud {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #00f2ff; /* Neon Cyan */
            text-shadow: 0 0 10px rgba(0, 242, 255, 0.5);
        }

        /* Başlangıç ve Bitiş Ekranları */
        #menu-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            z-index: 10;
        }

        h1 {
            font-size: 40px;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00f2ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            letter-spacing: -1px;
        }

        p {
            color: #aaa;
            font-size: 14px;
            max-width: 80%;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        button {
            background: #ffffff;
            color: #000;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: 600;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            transition: transform 0.2s;
        }

        button:active {
            transform: scale(0.95);
        }

        /* Dokunmatik Bölge Göstergeleri (Görsel ipucu) */
        .controls-hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            opacity: 0.3;
            font-size: 12px;
            color: #fff;
        }
        
        .control-zone {
            width: 100px;
            height: 100px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Debug / Bilgi */
        #level-indicator {
            font-weight: bold;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>

    <div id="ui-layer">
        <div class="hud">
            <span id="level-indicator">BÖLÜM 1</span>
            <span id="score">0</span>
        </div>
        <div class="controls-hint">
            <div class="control-zone">SOL</div>
            <div class="control-zone">SAĞ</div>
        </div>
    </div>

    <div id="menu-screen">
        <h1>NEON ASCENT</h1>
        <p>Karakter otomatik zıplar.<br>Yönlendirmek için ekranın <b>Sol Alt</b> veya <b>Sağ Alt</b> köşesine basılı tut.</p>
        <button id="start-btn">SİMÜLASYONU BAŞLAT</button>
    </div>

<script>
    // --- AYARLAR VE DEĞIŞKENLER ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const menuScreen = document.getElementById('menu-screen');
    const startBtn = document.getElementById('start-btn');
    const levelText = document.getElementById('level-indicator');
    const scoreText = document.getElementById('score');

    // Oyun Durumu
    let gameState = 'MENU'; // MENU, PLAYING, GAMEOVER, WIN
    let currentLevel = 1;
    let score = 0;
    let particles = []; // Görsel efektler için

    // Fizik Ayarları (Matematiksel Taban)
    const GRAVITY = 0.6;
    const JUMP_FORCE = -11;
    const MOVE_SPEED = 6; // Yatay hız
    const FRICTION = 0.8; // Kayganlık hissi

    // Oyuncu
    const player = {
        x: 0,
        y: 0,
        vx: 0, // Velocity X
        vy: 0, // Velocity Y
        width: 20,
        height: 20,
        color: '#00f2ff' // Neon Cyan
    };

    // Kamera
    let cameraY = 0;

    // Kontroller
    const input = {
        left: false,
        right: false
    };

    // Bölüm Verileri
    let platforms = [];
    let goal = { x: 0, y: 0, w: 40, h: 40, reached: false };

    // --- INIT & RESIZE ---
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- BÖLÜM TASARIMI (Level Generation) ---
    function generateLevel(level) {
        platforms = [];
        // Başlangıç platformu
        platforms.push({ x: canvas.width / 2 - 50, y: canvas.height - 100, w: 100, h: 15, type: 'static' });
        
        player.x = canvas.width / 2 - 10;
        player.y = canvas.height - 150;
        player.vx = 0;
        player.vy = 0;
        cameraY = 0;
        goal.reached = false;

        // Zorluk parametreleri (İstatistiksel artış)
        const platformCount = 15 + (level * 5); 
        const gapMax = 120 + (level * 10); // Yüksekliğe göre boşluk artar
        let currentY = canvas.height - 250;

        for (let i = 0; i < platformCount; i++) {
            // Rastgele Genişlik ve X konumu
            const w = Math.max(60, 150 - (level * 10)); // Bölüm arttıkça platformlar küçülür
            const x = Math.random() * (canvas.width - w);
            
            // Hareketli platform olasılığı (Level 2'den sonra başlar)
            let type = 'static';
            let speed = 0;
            if (level >= 2 && Math.random() > 0.7) {
                type = 'moving';
                speed = 2 + (level * 0.5);
            }

            platforms.push({
                x: x,
                y: currentY,
                w: w,
                h: 15,
                type: type,
                speed: speed,
                dir: 1
            });

            currentY -= (80 + Math.random() * 60); // Bir sonraki platform için yukarı çık
        }

        // Hedef (Portal)
        goal.x = canvas.width / 2 - 20;
        goal.y = currentY - 50;
        goal.w = 40;
        goal.h = 40;
    }

    // --- INPUT HANDLING (SAFARI TOUCH) ---
    function handleTouch(e) {
        e.preventDefault(); // Scroll'u engelle
        input.left = false;
        input.right = false;

        for (let i = 0; i < e.touches.length; i++) {
            const touch = e.touches[i];
            const halfWidth = window.innerWidth / 2;
            
            // Ekranın sol yarısı mı sağ yarısı mı?
            if (touch.clientX < halfWidth) {
                input.left = true;
            } else {
                input.right = true;
            }
        }
    }

    document.addEventListener('touchstart', handleTouch, { passive: false });
    document.addEventListener('touchmove', handleTouch, { passive: false });
    document.addEventListener('touchend', handleTouch, { passive: false });

    // --- OYUN DÖNGÜSÜ (PHYSICS & LOGIC) ---
    function update() {
        if (gameState !== 'PLAYING') return;

        // 1. Yatay Hareket (İvme bazlı)
        if (input.left) player.vx -= 1.5; // Hızlanma
        if (input.right) player.vx += 1.5;

        player.vx *= FRICTION; // Sürtünme
        player.x += player.vx;

        // Sınır Kontrolü (Ekrandan çıkarsa diğer taraftan girsin - Pacman usulü)
        if (player.x < -player.width) player.x = canvas.width;
        if (player.x > canvas.width) player.x = -player.width;

        // 2. Dikey Hareket (Yerçekimi)
        player.vy += GRAVITY;
        player.y += player.vy;

        // 3. Platform Çarpışması
        // Sadece aşağı düşerken çarpışma olur (vy > 0)
        if (player.vy > 0) {
            for (let p of platforms) {
                if (
                    player.x + player.width > p.x &&
                    player.x < p.x + p.w &&
                    player.y + player.height > p.y &&
                    player.y + player.height < p.y + p.h + 10 // Tolerans (Tunelling fix)
                ) {
                    // Zıpla!
                    player.vy = JUMP_FORCE;
                    createParticles(player.x + player.width/2, player.y + player.height, '#fff');
                    // Ses efekti eklenebilir (AudioContext ile)
                }
            }
        }

        // 4. Hareketli Platformlar
        platforms.forEach(p => {
            if (p.type === 'moving') {
                p.x += p.speed * p.dir;
                if (p.x <= 0 || p.x + p.w >= canvas.width) {
                    p.dir *= -1; // Yön değiştir
                }
            }
        });

        // 5. Kamera Takibi (Lerp - Linear Interpolation yerine basit takip)
        // Oyuncu ekranın yarısını geçerse kamerayı yukarı kaydır
        const targetCameraY = player.y - canvas.height / 2;
        if (targetCameraY < cameraY) {
            cameraY = targetCameraY;
            score += Math.floor(Math.abs(player.vy)); // Yukarı çıktıkça puan artar
            scoreText.innerText = score;
        }

        // 6. Hedef Kontrolü
        if (
            player.x < goal.x + goal.w &&
            player.x + player.width > goal.x &&
            player.y < goal.y + goal.h &&
            player.y + player.height > goal.y
        ) {
            levelUp();
        }

        // 7. Ölüm Kontrolü (Ekranın altından düştü mü?)
        if (player.y > cameraY + canvas.height) {
            gameOver();
        }

        // Parçacık güncellemesi
        updateParticles();
    }

    function levelUp() {
        currentLevel++;
        levelText.innerText = `BÖLÜM ${currentLevel}`;
        // Puanı koru ama leveli yenile
        generateLevel(currentLevel);
        
        // Görsel efekt
        createParticles(canvas.width/2, canvas.height/2, '#00f2ff', 50);
    }

    function gameOver() {
        gameState = 'GAMEOVER';
        menuScreen.style.display = 'flex';
        menuScreen.querySelector('h1').innerText = "SİMÜLASYON BAŞARISIZ";
        menuScreen.querySelector('p').innerText = `Toplam Skor: ${score}\nTekrar denemek için butona bas.`;
        startBtn.innerText = "YENİDEN BAŞLAT";
        currentLevel = 1;
        score = 0;
    }

    function startGame() {
        gameState = 'PLAYING';
        menuScreen.style.display = 'none';
        levelText.innerText = `BÖLÜM ${currentLevel}`;
        scoreText.innerText = "0";
        generateLevel(currentLevel);
        gameLoop();
    }

    // --- GÖRSEL EFEKTLER (PARTICLES) ---
    function createParticles(x, y, color, count = 10) {
        for (let i = 0; i < count; i++) {
            particles.push({
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 5,
                vy: (Math.random() - 0.5) * 5,
                life: 1.0,
                color: color
            });
        }
    }

    function updateParticles() {
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.05;
            if (p.life <= 0) particles.splice(i, 1);
        }
    }

    // --- ÇİZİM (RENDER) ---
    function draw() {
        // Arkaplanı temizle
        ctx.fillStyle = '#050505';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Kamera ötelemesi (Tüm dünyayı yukarı kaydır)
        ctx.save();
        ctx.translate(0, -cameraY);

        // Platformlar
        platforms.forEach(p => {
            // Neon efekti
            ctx.shadowBlur = 10;
            ctx.shadowColor = p.type === 'moving' ? '#ff00ff' : '#00f2ff'; // Hareketli: Magenta, Sabit: Cyan
            ctx.fillStyle = p.type === 'moving' ? '#ff00ff' : '#00f2ff';
            
            // Yuvarlak köşeli dikdörtgen
            ctx.fillRect(p.x, p.y, p.w, p.h);
            
            // Parlak üst kısım
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.fillRect(p.x, p.y, p.w, 4);
        });

        // Hedef (Portal)
        ctx.shadowBlur = 20;
        ctx.shadowColor = '#ffe600'; // Sarı
        ctx.fillStyle = '#ffe600';
        ctx.beginPath();
        ctx.arc(goal.x + goal.w/2, goal.y + goal.h/2, 20, 0, Math.PI * 2);
        ctx.fill();
        // Portal içi girdap efekti (Basit)
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(goal.x + goal.w/2, goal.y + goal.h/2, 10 + Math.sin(Date.now()/200)*5, 0, Math.PI * 2);
        ctx.fill();

        // Oyuncu
        ctx.shadowBlur = 15;
        ctx.shadowColor = player.color;
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);

        // Oyuncu İzi (Motion Blur hissi)
        ctx.globalAlpha = 0.3;
        ctx.fillRect(player.x - player.vx, player.y - player.vy, player.width, player.height);
        ctx.globalAlpha = 1.0;

        // Parçacıklar
        particles.forEach(p => {
            ctx.fillStyle = `rgba(255, 255, 255, ${p.life})`;
            ctx.shadowBlur = 0;
            ctx.fillRect(p.x, p.y, 3, 3);
        });

        ctx.restore();
    }

    // --- ANA DÖNGÜ ---
    function gameLoop() {
        if (gameState === 'PLAYING') {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
    }

    // Buton Dinleyicisi
    startBtn.addEventListener('click', startGame);
    startBtn.addEventListener('touchstart', (e) => {
        e.preventDefault(); // 300ms gecikmeyi önle
        startGame();
    });

    // İlk çizim (Siyah ekran kalmasın)
    ctx.fillStyle = '#050505';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

</script>
</body>
</html>